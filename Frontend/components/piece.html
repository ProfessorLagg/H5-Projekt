<template id="tmpl-game-piece">
    <style>
        :host {
            aspect-ratio: 1/1 !important;
            /**/
            /* background-color: magenta; */
            outline: 1px solid rgba(255, 255, 255, 20%);
            /**/
            display: grid;
            grid-auto-flow: row dense;
            grid-auto-columns: minmax(0, 1fr);
            grid-auto-rows: minmax(0, 1fr);
            grid-template-columns: repeat(5, minmax(0, 1fr));
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 0em 0em;
            grid-template-areas:
                ". . . . ."
                ". . . . ."
                ". . . . ."
                ". . . . ."
                ". . . . ."
                ". . . . .";
            justify-content: center;
        }

        .piece-block {
            aspect-ratio: 1/1 !important;
            background-color: hsla(30, 100%, 24%, 100%);
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        .piece-block-img {
            max-width: 100%;
            max-height: 100%;
            margin: 0;
            padding: 0;
        }

        /* Block Placement*/
        .piece-block[row="0"] {
            grid-row: 1;
        }

        .piece-block[row="1"] {
            grid-row: 2;
        }

        .piece-block[row="2"] {
            grid-row: 3;
        }

        .piece-block[row="3"] {
            grid-row: 4;
        }

        .piece-block[row="4"] {
            grid-row: 5;
        }

        .piece-block[col="0"] {
            grid-column: 1;
        }

        .piece-block[col="1"] {
            grid-column: 2;
        }

        .piece-block[col="2"] {
            grid-column: 3;
        }

        .piece-block[col="3"] {
            grid-column: 4;
        }

        .piece-block[col="4"] {
            grid-column: 5;
        }
    </style>
</template>
<template id="tmpl-piece-block">
    <div row="0" col="0" class="piece-block">
        <img src="/img/block_white.svg" alt="block white" class="piece-block-img">
    </div>
</template>
<script id="scrpt-game-piece">
    const pieceElementNameElementName = 'game-piece';
    const pieceElementNameTemplateId = 'tmpl-game-piece';
    const pieceElementNameTemplate = document.getElementById(pieceElementNameTemplateId);
    const blockElementTemplateId = 'tmpl-piece-block';
    const blockElementTemplate = document.getElementById(blockElementTemplateId);

    let shapes = { 0: [{ r: 0, c: 0 }], 1: [{ r: 0, c: 0 }], 2: [{ r: 0, c: 0 }], 3: [{ r: 0, c: 0 }], 4: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 5: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 6: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 7: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 8: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 9: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 10: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 11: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 12: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 13: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 14: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 15: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 16: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }], 17: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }], 18: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }], 19: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }], 20: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }, { r: 0, c: 4 }], 21: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }, { r: 0, c: 4 }], 22: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }, { r: 0, c: 4 }], 23: [{ r: 0, c: 0 }, { r: 0, c: 1 }, { r: 0, c: 2 }, { r: 0, c: 3 }, { r: 0, c: 4 }], 24: [{ r: 2, c: 1 }, { r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 25: [{ r: 2, c: 1 }, { r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 26: [{ r: 2, c: 1 }, { r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 27: [{ r: 2, c: 1 }, { r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 28: [{ r: 2, c: 0 }, { r: 2, c: 1 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 1 }], 29: [{ r: 2, c: 0 }, { r: 2, c: 1 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 1 }], 30: [{ r: 2, c: 0 }, { r: 2, c: 1 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 1 }], 31: [{ r: 2, c: 0 }, { r: 2, c: 1 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 1 }], 32: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 33: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 34: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 35: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 1 }], 36: [{ r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 37: [{ r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 38: [{ r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 39: [{ r: 1, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 40: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 41: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 42: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 43: [{ r: 1, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 1 }, { r: 0, c: 2 }], 44: [{ r: 1, c: 0 }, { r: 0, c: 1 }], 45: [{ r: 1, c: 0 }, { r: 0, c: 1 }], 46: [{ r: 1, c: 0 }, { r: 0, c: 1 }], 47: [{ r: 1, c: 0 }, { r: 0, c: 1 }], 48: [{ r: 2, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 2 }], 49: [{ r: 2, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 2 }], 50: [{ r: 2, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 2 }], 51: [{ r: 2, c: 0 }, { r: 1, c: 1 }, { r: 0, c: 2 }], 52: [{ r: 3, c: 0 }, { r: 2, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 3 }], 53: [{ r: 3, c: 0 }, { r: 2, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 3 }], 54: [{ r: 3, c: 0 }, { r: 2, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 3 }], 55: [{ r: 3, c: 0 }, { r: 2, c: 1 }, { r: 1, c: 2 }, { r: 0, c: 3 }], 56: [{ r: 1, c: 1 }, { r: 0, c: 0 }], 57: [{ r: 1, c: 1 }, { r: 0, c: 0 }], 58: [{ r: 1, c: 1 }, { r: 0, c: 0 }], 59: [{ r: 1, c: 1 }, { r: 0, c: 0 }], 60: [{ r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 61: [{ r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 62: [{ r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 63: [{ r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 64: [{ r: 3, c: 3 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 65: [{ r: 3, c: 3 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 66: [{ r: 3, c: 3 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 67: [{ r: 3, c: 3 }, { r: 2, c: 2 }, { r: 1, c: 1 }, { r: 0, c: 0 }], 68: [{ r: 2, c: 0 }, { r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 69: [{ r: 2, c: 0 }, { r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 70: [{ r: 2, c: 0 }, { r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 71: [{ r: 2, c: 0 }, { r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 72: [{ r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 73: [{ r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 74: [{ r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 75: [{ r: 1, c: 0 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 76: [{ r: 2, c: 1 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 77: [{ r: 2, c: 1 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 78: [{ r: 2, c: 1 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 79: [{ r: 2, c: 1 }, { r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 80: [{ r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 81: [{ r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 82: [{ r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }], 83: [{ r: 1, c: 1 }, { r: 0, c: 0 }, { r: 0, c: 1 }] };
    let shapeIds = Object.keys(shapes).flatMap(x => Number(x)).filter(x => TypeChecker.isInteger(x) && x >= 0);
    class CustomPieceElement extends HTMLElement {
        static observedAttributes = ['shapeId'];
        connectedCallback() {
            let templateContent = pieceElementNameTemplate.content;

            this.attachShadow({ mode: "open" });
            this.shadowRoot.appendChild(templateContent.cloneNode(true));
            // this.shapeId = ((Math.random() * shapeIds.length) | 0);
            this.shapeId = 13;
        }
        attributeChangedCallback(name, oldValue, newValue) {
            console.debug(this.localName, `attributeChangedCallback(name: ${name}, oldValue: ${oldValue},newValue: ${newValue},")`);
            if (name === 'shapeId') {
                this.render();
            }
        }
        render() {
            console.debug(this, "render()");
            let blocks = this.blocks;
            for (let i = 0; i < blocks.length; i++) {
                blocks[i].remove();
            }
            blocks = this.blocks;
            let shape = this.shape;
            console.log("shape:", shape);
            for (let i = 0; i < shape.length; i++) {
                const offset = shape[i];
                let clone = blockElementTemplate.content.cloneNode(true);
                let elem = clone.firstElementChild;
                elem.setAttribute("row", offset.r);
                elem.setAttribute("col", offset.c);
                this.shadowRoot.appendChild(elem);
            }
        }
        get blocks() {
            return Array.from(this.shadowRoot.querySelectorAll(".piece-block"));
        }
        get shape() {
            return shapes[this.shapeId];
        }
        get shapeId() {
            return parseInt(this.getAttribute('shapeId'));
        }
        set shapeId(v) {
            if (!TypeChecker.isInteger(v)) { throw Error(`${v} is not a valid shape id`); }
            if (v < 0 || v > shapeIds.length) { throw Error(`${v} is not a valid shape id`); }
            if (this.shapeId !== v) {
                this.setAttribute('shapeId', v);
                this.render();
            }
        }

        constructor() {
            super();
        }
    }

    customElements.define(pieceElementNameElementName, CustomPieceElement);
</script>